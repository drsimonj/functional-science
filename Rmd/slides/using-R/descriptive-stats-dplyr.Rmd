---
title: "Descriptive Statistics"
author: "Simon A Jackson"
date: "Knit on `r format(Sys.time(), '%d %B, %Y')`"
output: ioslides_presentation
---

```{r setup, echo = F, warning = F}
require(knitr, quietly = TRUE)
opts_knit$set(root.dir = '../../../')
```

# Setup

## Packages

We'll make use of the `dplyr` and `psych` packages.

Make sure they're installed on you system and then attach them to your workspace.

```{r, eval = F}
# Install the package from CRAN (if necessary)
install.packages(c("dplyr", "psych"))

# Attach to your workspace
library(dplyr)
library(psych)
```
```{r, include = F}
library(dplyr)
library(psych)
```

## Our Data Set

Let's read in the flight times data to practice.

```{r}
d <- read.csv("data/flight-times.csv")
head(d)
```

# dplyr Grouping and Summarising

## Splitting data into groups

Often we're interested in splitting our data into groups.

We do this with the dplyr function, `group_by()`

For example:

```{r}
by.fn <- group_by(d, ORIGIN)
```

Other dplyr functions will now treat `by.fn` as multiple data frames: one for each level of the FL_NUM factor.

More to come...

## Summarising Data

To summarise information about a data frame, we use the dplyr function, `summarise()`

```{r}
summarise(d, mean = mean(CRS_DEP_TIME))
```

# Univariate Analysis

## Frequencies and Proportions

```{r}
table(d$CARRIER)  # Print frequencies
table(d$CARRIER) %>% prop.table()  # Print proportions
```

## Frequencies and Proportions

A dplyr solution: `group_by(factor)` and then `summarise()` with `n()`.

```{r}
d %>%
  group_by(CARRIER) %>%
  summarise(n = n())
```

## Frequencies and Proportions

and for proportions, divide through by the total number of rows in the data.

```{r}
d %>%
  group_by(CARRIER) %>%
  summarise(n = n(), p = n / nrow(d))
```

## Central Tendency

Many base functions for describing distribution. Many require `na.rm = TRUE` to remove missing values.

```{r}
no.miss <- c(1, 20, 29.353, .20)
mean(no.miss)
with.miss <- c(1, 20, 29.353, NA)
mean(with.miss)
mean(with.miss, na.rm = TRUE)
```

## Central Tendency

```{r}
mean(d$DEP_DELAY, na.rm = TRUE)  # mean
median(d$DEP_DELAY, na.rm = TRUE)  # Median
```

## Position

```{r}
min(d$DEP_DELAY, na.rm = TRUE)  # minimum/smallest value
max(d$DEP_DELAY, na.rm = TRUE)  # maximum/largest value
```

## Position

```{r}
quantile(d$DEP_DELAY, na.rm = TRUE)  # Quantiles
quantile(d$DEP_DELAY, .95, na.rm = TRUE)
quantile(d$DEP_DELAY, c(.025, .975), na.rm = TRUE)
```

## Dispersion

```{r}
range(d$DEP_DELAY, na.rm = TRUE)  # range
var(d$DEP_DELAY, na.rm = TRUE)  # variance
sd(d$DEP_DELAY, na.rm = TRUE)  # Standard deviation
```

## Conditional Distribution

Sometimes you're interested in knowing the number/proportion of values that meet some condition. This takes two steps. The trick is to work with boolean values, knowing that `TRUE` is treated as `1`, and `FALSE` as `0`.

1. Create boolean vector corresponding to conditional.
2. Treating this as a vector of 1s and 0s, use the likes of `sum()` or `mean()` to compute the sum or proportion of TRUE.

## Conditional Distribution

```{r}
sum(d$DEP_DELAY > 60, na.rm = TRUE)
mean(d$DEP_DELAY > 60, na.rm = TRUE)
prop.table(table(d$DEP_DELAY > 60))
```

## Putting it Together with dplyr

Can combine with `summarise()` into a useful table.

```{r}
d %>%
  filter(!is.na(DEP_DELAY)) %>%  # remove rows with missing values
  summarise(
    n = n(),
    n.delayed = sum(DEP_DELAY > 0),
    mean = mean(DEP_DELAY),
    median = median(DEP_DELAY),
    sd = sd(DEP_DELAY),
    q5 = quantile(DEP_DELAY, .05),
    q95 = quantile(DEP_DELAY, .95)
  )
```

## Putting it Together with dplyr

Remember, it's easy to save results as a .csv file.

```{r, eval = F}
x <- d %>%
      filter(!is.na(DEP_DELAY)) %>%  # remove rows with missing values
      summarise(
        n = n(),
        n.delayed = sum(DEP_DELAY > 0),
        mean = mean(DEP_DELAY),
        median = median(DEP_DELAY),
        sd = sd(DEP_DELAY),
        q5 = quantile(DEP_DELAY, .05),
        q95 = quantile(DEP_DELAY, .95)
      )
write.csv(x, "descriptives.csv")
```

## Some Simple Plots

Barplot for factors

```{r}
my.table <- table(d$CARRIER)
barplot(my.table)
```

## Some Simple Plots

Histogram for numeric variable.

```{r}
hist(d$DEP_DELAY)  # Histogram
```

## Some Simple Plots

Boxplot for numeric variable.

```{r}
boxplot(d$DEP_DELAY)  # boxplot
```

## Some Simple Plots

Boxplot for numeric variable.

```{r}
d %>%
  filter(DEP_DELAY > quantile(DEP_DELAY, .2, na.rm = TRUE) &
         DEP_DELAY < quantile(DEP_DELAY, .8, na.rm = TRUE)) %>%
  select(DEP_DELAY) %>%
  boxplot()
```

## Other Quick Variable Summaries

## Overall Summmaries

Easy base function, `summary(data)`

```{r}
summary(d)
```

## Overall Summmaries

Another is `describe(data)` from the `psych` package.

```{r, warning = F}
describe(d)
```

# Bivariate Analysis

## Cross-tabs (Factor x Factor)

Add more arguements to `table()`

```{r}
table(d$ORIGIN, d$CARRIER)

d %>%
  select(ORIGIN, CARRIER) %>%
  table() %>%
  prop.table()

prop.table(my.table)  # Cell proportions
```

## Describing by Group (Factor x Numeric)

The dplyr approach can be easily extended to multiple groups with `group_by()`

```{r}
d %>% group_by(CARRIER) %>%
  summarise(n = n(), mean = mean(DEP_DELAY, na.rm = T))
```

## Describing by Group (Factor x Numeric)

Another descriptive method is provided by the `psych` package using `describeBy(mydata, group, ...)`

```{r}
describeBy(d[, c("DEP_DELAY", "TAXI_OUT")], d$CARRIER)
```

## Multivariate Visualisations (*n* Numeric)

`psych` provides a great function, `pairs.panels(data)`

```{r}
d %>%
  select(CRS_DEP_TIME, TAXI_OUT, DEP_DELAY) %>%
  pairs.panels()
```
